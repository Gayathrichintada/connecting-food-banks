<!DOCTYPE html>
<html>
<head>
<title>User</title>
<style>
body{font-family:Arial;background:#f4f4f4;margin:0;}

.card{background:white;max-width:400px;margin:30px auto;padding:20px;
border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
input,textarea,button{width:100%;padding:8px;margin:5px 0;}
button{background:#149ed5;color:white;border:none;}
/* ===== NAVBAR ===== */
#nav {
  background-color: #1aa0d8;
  padding: 15px 0;
  display: flex;
  justify-content: center;
  gap: 15px;
}

#nav a {
  text-decoration: none;
  color: white;
  background-color: #0b6a91;
  padding: 10px 22px;
  border-radius: 6px;
  font-weight: bold;
  transition: background-color 0.3s ease;
}

#nav a:hover {
  background-color: #084e6a;
}

</style>
</head>

<body>

<div id="nav">
  <a href="food bank.html">Home</a>
  <a href="about.html">About</a>
  <a href="donor-register.html">Donor</a>
  <a href="food-bank.html">Food Bank</a>
  <a href="user-register.html">User</a>
</div>

<div class="container">

  <!-- User Registration -->
  <div class="card">
    <h2>User Registration</h2>
    <input type="text" id="name" placeholder="Name" required>
    <input type="password" id="password" placeholder="Password" required>
    <input type="number" id="age" placeholder="Age" required>
    <input type="number" id="number" placeholder="Phone" required>
    <textarea id="address" placeholder="Address" required></textarea>
    <button onclick="registerUser()">Register</button>
  </div>

  <!-- Available Donations -->
  <div class="card">
    <h2>Available Donations</h2>
    <input type="number" id="user_id" placeholder="Enter Your User ID" required>
    <div id="donations-container"></div>
    <button id="show-donations-btn">Show Donations</button>
  </div>

</div>

<script>
const donationsContainer = document.getElementById("donations-container");

// Register User
function registerUser() {
  const name = document.getElementById("name").value;
  const password = document.getElementById("password").value;
  const age = document.getElementById("age").value;
  const phone = document.getElementById("number").value;
  const address = document.getElementById("address").value;

  fetch("http://localhost:3000/user/register", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({name,password,age,phone,address})
  })
  .then(res => res.json())
  .then(data => alert(data.message))
  .catch(err => console.error(err));
}

// Show all donations
document.getElementById("show-donations-btn").addEventListener("click", fetchDonations);
function fetchDonations() {
  donationsContainer.innerHTML = "";
  fetch("http://localhost:3000/donations")
    .then(res => res.json())
    .then(data => {
      if(data.length===0){ donationsContainer.textContent="No donations available."; return; }
      data.forEach(d => {
        const div = document.createElement("div");
        div.innerHTML = `
          Donor ID: ${d.donor_id}, Food: ${d.food_item}, Quantity: ${d.quantity}
          <button onclick="requestFromDonor(${d.donor_id},'${d.food_item}',${d.quantity})">Request This</button><hr>
        `;
        donationsContainer.appendChild(div);
      });
    }).catch(err=>console.error(err));
}

// Send request to donor
function requestFromDonor(donorId, foodItem, quantity) {
  const userId = parseInt(document.getElementById("user_id").value);
  if(!userId) return alert("Please enter your User ID.");

  fetch("http://localhost:3000/user/sendRequest", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({user_id:userId, donor_id:donorId, food_item:foodItem, quantity})
  })
  .then(res=>res.json())
  .then(data=>alert(data.message))
  .catch(err=>console.error(err));
}
</script>

</body>
</html>
